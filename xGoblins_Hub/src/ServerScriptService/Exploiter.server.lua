local DSExploits = game:GetService("DataStoreService"):GetDataStore("ExploitLogs")
local Http = game:GetService("HttpService")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local WEBHOOK = "webhook"

local KEY = ReplicatedStorage:WaitForChild("Keys"):WaitForChild("KEY5")

local Players = game:GetService("Players")

local Purchases = game.ReplicatedStorage.MainPurchases
local Prompts = game.ReplicatedStorage.Prompts

local GiveUGC = Purchases.GiveUGC
local hair = Prompts.PromptUGC_hair
local face = Prompts.PromptUGC_face
local backpack = Prompts.PromptUGC_backpack
local catalog = Prompts.PromptCatalog
local hamster = Prompts.PromptUGC_hamster

local function Banned(player)
	local config = {
		UserIds = {player.UserId},
		Duration = -1,
		DisplayReason = "EXPLOIT DETECTED",
		PrivateReason = "EXPLOITING - FIRED UNUSED REMOTE",
		ExcludeAltAccounts = false,
		ApplyToUniverse = true
	}
	local sucess, err = pcall(function()
		return Players:BanAsync(config)
	end)
	print(sucess, err)
	if sucess then
		player:Kick("EXPLOITING")
	end
	return
end


GiveUGC.OnServerEvent:Connect(function(player, ...)
	local args = {...}
	pcall(function()
		DSExploits:SetAsync(
			KEY.value..player.UserId, {
				User = player.Name,
				UserId = player.UserId,
				Time = os.date("%m/%d/%Y %H:%M:%S"),
				Args = args,
				true
			})
	end)

	local msg = {
		["content"] = "<@607307380954234910>",
		["embeds"] = {{
			["title"] = "EXPLOIT DETECTED",
			["color"] = 0xff0000,
			["fields"] = {
				{["name"] = "User", ["value"] = player.Name, ["inline"] = true},
				{["name"] = "UserId", ["value"] = tostring(player.UserId), ["inline"] = true},
				{["name"] = "Time", ["value"] = os.date("%m/%d/%Y %H:%M:%S"), ["inline"] = false},
			}
		}}
	}
	Http:PostAsync(WEBHOOK, Http:JSONEncode(msg))
	Banned(player)
end)

hair.OnServerEvent:Connect(function(player, ...)
	local args = {...}
	pcall(function()
		DSExploits:SetAsync(
			KEY.Value..player.UserId, {
				User = player.Name,
				UserId = player.UserId,
				Time = os.date("%m/%d/%Y %H:%M:%S"),
				Args = args,
				true
			})
	end)

	local msg = {
		["content"] = "<@607307380954234910>",
		["embeds"] = {{
			["title"] = "EXPLOIT DETECTED",
			["color"] = 0xff0000,
			["fields"] = {
				{["name"] = "User", ["value"] = player.Name, ["inline"] = true},
				{["name"] = "UserId", ["value"] = tostring(player.UserId), ["inline"] = true},
				{["name"] = "Time", ["value"] = os.date("%m/%d/%Y %H:%M:%S"), ["inline"] = false},
			}
		}}
	}
	Http:PostAsync(WEBHOOK, Http:JSONEncode(msg))
	Banned(player)
end)

face.OnServerEvent:Connect(function(player, ...)
	local args = {...}
	pcall(function()
		DSExploits:SetAsync(
			KEY.Value..player.UserId, {
				User = player.Name,
				UserId = player.UserId,
				Time = os.date("%m/%d/%Y %H:%M:%S"),
				Args = args,
				true
			})
	end)

	local msg = {
		["content"] = "<@607307380954234910>",
		["embeds"] = {{
			["title"] = "EXPLOIT DETECTED",
			["color"] = 0xff0000,
			["fields"] = {
				{["name"] = "User", ["value"] = player.Name, ["inline"] = true},
				{["name"] = "UserId", ["value"] = tostring(player.UserId), ["inline"] = true},
				{["name"] = "Time", ["value"] = os.date("%m/%d/%Y %H:%M:%S"), ["inline"] = false},
			}
		}}
	}
	Http:PostAsync(WEBHOOK, Http:JSONEncode(msg))
	Banned(player)
end)

backpack.OnServerEvent:Connect(function(player, ...)
	local args = {...}
	pcall(function()
		DSExploits:SetAsync(
			KEY.Value..player.UserId, {
				User = player.Name,
				UserId = player.UserId,
				Time = os.date("%m/%d/%Y %H:%M:%S"),
				Args = args,
				true
			})
	end)

	local msg = {
		["content"] = "<@607307380954234910>",
		["embeds"] = {{
			["title"] = "EXPLOIT DETECTED",
			["color"] = 0xff0000,
			["fields"] = {
				{["name"] = "User", ["value"] = player.Name, ["inline"] = true},
				{["name"] = "UserId", ["value"] = tostring(player.UserId), ["inline"] = true},
				{["name"] = "Time", ["value"] = os.date("%m/%d/%Y %H:%M:%S"), ["inline"] = false},
			}
		}}
	}
	Http:PostAsync(WEBHOOK, Http:JSONEncode(msg))
	Banned(player)	
end)

catalog.OnServerEvent:Connect(function(player, ...)
	local args = {...}
	pcall(function()
		DSExploits:SetAsync(
			KEY.Value..player.UserId, {
				User = player.Name,
				UserId = player.UserId,
				Time = os.date("%m/%d/%Y %H:%M:%S"),
				Args = args,
				true
			})
	end)

	local msg = {
		["content"] = "<@607307380954234910>",
		["embeds"] = {{
			["title"] = "EXPLOIT DETECTED",
			["color"] = 0xff0000,
			["fields"] = {
				{["name"] = "User", ["value"] = player.Name, ["inline"] = true},
				{["name"] = "UserId", ["value"] = tostring(player.UserId), ["inline"] = true},
				{["name"] = "Time", ["value"] = os.date("%m/%d/%Y %H:%M:%S"), ["inline"] = false},
			}
		}}
	}
	Http:PostAsync(WEBHOOK, Http:JSONEncode(msg))
	Banned(player)
end)

hamster.OnServerEvent:Connect(function(player, ...)
	local args = {...}
	pcall(function()
		DSExploits:SetAsync(
			KEY.Value..player.UserId, {
				User = player.Name,
				UserId = player.UserId,
				Time = os.date("%m/%d/%Y %H:%M:%S"),
				Args = args,
				true
			})
	end)

	local msg = {
		["content"] = "<@607307380954234910>",
		["embeds"] = {{
			["title"] = "EXPLOIT DETECTED",
			["color"] = 0xff0000,
			["fields"] = {
				{["name"] = "User", ["value"] = player.Name, ["inline"] = true},
				{["name"] = "UserId", ["value"] = tostring(player.UserId), ["inline"] = true},
				{["name"] = "Time", ["value"] = os.date("%m/%d/%Y %H:%M:%S"), ["inline"] = false},
			}
		}}
	}
	Http:PostAsync(WEBHOOK, Http:JSONEncode(msg))
	Banned(player)
end)